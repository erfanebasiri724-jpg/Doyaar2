<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>کافه بستنی دویار - POS حرفه‌ای</title>
<style>
body{font-family:sans-serif;background:#fff0f5;margin:0;padding:0;color:#333;}
header{background:#d18cd1;color:white;padding:15px;text-align:center;font-size:1.5em;font-weight:bold;}
.container{display:flex;flex-wrap:wrap;padding:10px;}
.categories{flex:1 1 60%;padding:10px;max-width:800px;position:relative;}
.details-category{background:#fff0ff;margin-bottom:10px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
.details-category summary{padding:10px;background:#e5b3f2;border-radius:6px;cursor:pointer;font-weight:bold;}
.product-card{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-top:1px solid #eee;border-radius:4px;margin:3px 0;transition:0.2s; background:#fff;}
.product-card:hover{background:#ffe6ff;}
.product-card button{background:#d18cd1;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;transition:0.2s;}
.product-card button:hover{background:#b069c2;}
.added-tick{color:green;margin-left:5px;display:none;font-weight:bold;}
.cart-container{flex:1 1 35%;padding:10px;position:sticky;top:10px;max-height:80vh;overflow:auto;background:#fff0ff;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;}
.cart-header button{background:#d18cd1;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;margin-left:5px;margin-top:5px;transition:0.2s;}
.cart-header button:hover{background:#b069c2;}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-top:1px solid #eee;}
.cart-item button{padding:2px 6px;margin:0 2px;border:none;border-radius:4px;background:#d18cd1;color:white;cursor:pointer;transition:0.2s;}
.cart-item button:hover{background:#b069c2;}
#searchBar{width:100%;padding:8px;margin-bottom:10px;border-radius:4px;border:1px solid #ccc;}
#searchResults{background:white;border:1px solid #ccc;border-radius:4px;max-height:200px;overflow:auto;position:absolute;z-index:100;display:none;width:calc(100% - 20px);}
.search-item{padding:5px;cursor:pointer;display:flex;justify-content:space-between;}
.search-item:hover{background:#ffe6ff;}
.highlight{background-color:yellow;}
.invoicePrint{display:none;}
</style>
</head>
<body>
<header>کافه بستنی دویار - POS حرفه‌ای</header>

<div class="container">
  <div class="categories">
    <input type="text" id="searchBar" placeholder="جستجوی محصول...">
    <div id="searchResults"></div>
    <div id="categories"></div>
  </div>
  
  <div class="cart-container">
    <div class="cart-header">
      <span>سبد خرید 🛒 <span id="cartCount">0</span></span>
      <button id="printBtn">چاپ فاکتور</button>
      <button id="emptyCartBtn">🗑 خالی کردن سبد</button>
    </div>
    <div id="cartItems"></div>
    <div style="margin-top:10px;font-weight:bold;">جمع کل: <span id="cartTotal">0</span> تومان</div>
  </div>
</div>

<div class="invoicePrint" id="invoicePrint">
  <h3 style="text-align:center;">کافه بستنی دویار</h3>
  <table style="width:100%;border-collapse:collapse;" id="invBody"></table>
  <p>جمع کل: <span id="invTotal"></span> تومان</p>
  <p>تاریخ: <span id="invDate"></span></p>
</div>

<script>
// ======= داده‌ها =======
const productsData=[
{name:"بستنی سنتی بدون مغز",price:220000,category:"بستنی‌ها"},
{name:"بستنی سنتی مغزدار",price:260000,category:"بستنی‌ها"},
{name:"بستنی سنتی لیوانی",price:40000,category:"بستنی‌ها"},
{name:"بستنی سنتی حصیری",price:40000,category:"بستنی ها"},
{name:"طالبی بستنی",price:70000,category:"بستنی‌ها"},
{name:"آب هویج بستنی",price:60000,category:"بستنی‌ها"},
{name:"بستنی اسکوپی",price:25000,category:"بستنی‌ها"},
{name:"فالوده",price:50000,category:"فالوده"},
{name:"فالوده بستنی",price:70000,category:"فالوده"},
{name:"آب هویج",price:40000,category:"آبمیوه"},
{name:"آب انار",price:90000,category:"آبمیوه"},
{name:"آب زرشک",price:90000,category:"آبمیوه"},
{name:"آب سیب",price:70000,category:"آبمیوه"},
{name:"آب طالبی",price:60000,category:"آبمیوه"},
{name:"آب هندوانه",price:60000,category:"آبمیوه"},
{name:"آب آلبالو",price:60000,category:"آبمیوه"},
{name:"آب پرتغال",price:80000,category:"آبمیوه"},
{name:"شیر موز",price:80000,category:"شیرها و شیک‌ها"},
{name:"شیر موز خرما",price:120000,category:"شیرها و شیک‌ها"},
{name:"شیر موز گردو",price:150000,category:"شیرها و شیک‌ها"},
{name:"شیر پسته",price:150000,category:"شیرها و شیک‌ها"},
{name:"شیر انبه",price:180000,category:"شیرها و شیک‌ها"},
{name:"شیر موز بستنی",price:100000,category:"شیرها و شیک‌ها"},
{name:"شیک",price:120000,category:"شیرها و شیک‌ها"},
{name:"آیس پک",price:120000,category:"شیرها و شیک‌ها"},
{name:"معجون لیوانی",price:160000,category:"معجون و کیک بستنی"},
{name:"معجون کاسه‌ای کوچک",price:180000,category:"معجون و کیک بستنی"},
{name:"معجون کاسه‌ای بزرگ",price:250000,category:"معجون و کیک بستنی"},
{name:"کیک بستنی لیوانی",price:70000,category:"معجون و کیک بستنی"},
{name:"کیک بستنی مخصوص",price:150000,category:"معجون و کیک بستنی"},
{name:"ذرت مکزیکی کوچک",price:90000,category:"ذرت‌ها"},
{name:"ذرت مکزیکی بزرگ",price:130000,category:"ذرت‌ها"},
{name:"کیک شکلاتی",price:90000,category:"متفرقه"},
{name:"آب معدنی کوچک",price:10000,category:"متفرقه"},
{name:"آب معدنی بزرگ",price:15000,category:"متفرقه"},
{name:"لایف",price:50000,category:"متفرقه"},
{name:"هایپ",price:60000,category:"متفرقه"},
{name:"کینگ",price:45000,category:"متفرقه"},
{name:"کرونا",price:150000,category:"متفرقه"},
{name:"ویتامین سی",price:40000,category:"متفرقه"},
{name:"نوشیدنی گیاهی",price:40000,category:"متفرقه"},
{name:"نوشیدنی گیاهی زعفرانی",price:45000,category:"متفرقه"},
{name:"آیس مانکی",price:50000,category:"متفرقه"},
{name:"آلوورا",price:42000,category:"متفرقه"},
{name:"لیموناد شیشه ای",price:35000,category:"متفرقه"},
{name:"بطری ۱ لیتری آب هویج",price:80000,category:"بطری‌ها"},
{name:"بطری ۱ لیتری آب طالبی",price:140000,category:"بطری‌ها"},
{name:"بطری ۱ لیتری آب سیب",price:180000,category:"بطری‌ها"},
{name:"بطری ۱ لیتری آب هندوانه",price:120000,category:"بطری‌ها"},
{name:"بطری ۱ لیتری آب پرتغال",price:200000,category:"بطری‌ها"},
{name:"بطری ۱ لیتری شیر موز",price:180000,category:"بطری‌ها"}
];

const categoriesData=[...new Set(productsData.map(p=>p.category))];
let cart=[];

// ======= المان‌ها =======
const categoriesDiv=document.getElementById('categories');
const cartItemsDiv=document.getElementById('cartItems');
const cartTotal=document.getElementById('cartTotal');
const cartCount=document.getElementById('cartCount');
const searchBar=document.getElementById('searchBar');
const searchResults=document.getElementById('searchResults');
const printBtn=document.getElementById('printBtn');
const emptyCartBtn=document.getElementById('emptyCartBtn');

// ======= رندر دسته‌ها =======
function renderCategories(){
categoriesDiv.innerHTML='';
categoriesData.forEach(cat=>{
const catProducts=productsData.filter(p=>p.category===cat);
const details=document.createElement('details');
const summary=document.createElement('summary');
summary.textContent=cat;
details.appendChild(summary);
catProducts.forEach(p=>{
const div=document.createElement('div');
div.className='product-card';
div.innerHTML=`<span>${p.name} - ${p.price.toLocaleString()} تومان <span class="added-tick">✔</span></span><button>اضافه کردن</button>`;
const btn=div.querySelector('button');
const tick=div.querySelector('.added-tick');
btn.addEventListener('click',()=>{
addToCart(p);tick.style.display='inline';setTimeout(()=>tick.style.display='none',300);
});
details.appendChild(div);
});
categoriesDiv.appendChild(details);
});
}

// ======= افزودن به سبد =======
function addToCart(product){
let found=cart.find(item=>item.name===product.name);
if(found){found.qty++;}else{cart.push({...product,qty:1});}
updateCart();
}

// ======= حذف از سبد =======
function removeFromCart(product){
cart=cart.filter(item=>item.name!==product.name);
updateCart();
}

// ======= کم کردن تعداد =======
function decrementItem(product){
let found=cart.find(item=>item.name===product.name);
if(found){found.qty--; if(found.qty<=0) removeFromCart(product);}
updateCart();
}

// ======= آپدیت سبد =======
function updateCart(){
cartItemsDiv.innerHTML='';
let total=0;
cart.forEach(it=>{
const div=document.createElement('div');
div.className='cart-item';
div.innerHTML=`<span>${it.name} (${it.qty})</span>
<div>
<button onclick='decrementItem(${JSON.stringify(it)})'>-</button>
<button onclick='addToCart(${JSON.stringify(it)})'>+</button>
<button onclick='removeFromCart(${JSON.stringify(it)})'>حذف</button>
</div>`;
cartItemsDiv.appendChild(div);
total+=it.price*it.qty;
});
cartTotal.textContent=total.toLocaleString();
cartCount.textContent=cart.reduce((a,b)=>a+b.qty,0);
localStorage.setItem('cart',JSON.stringify(cart));
}

// ======= بارگذاری سبد از localStorage =======
window.onload=function(){
const saved=localStorage.getItem('cart');
if(saved) cart=JSON.parse(saved);
updateCart();
renderCategories();
}

// ======= جستجوی پیشرفته با هایلایت و Quick Add =======
searchBar.addEventListener('input',()=>{
const val=searchBar.value.trim().replace(/آ/g,'ا');
if(val===''){searchResults.style.display='none';return;}
let regex=new RegExp(`(${val})`,"gi");
let filtered=productsData.filter(p=>p.name.replace(/آ/g,'ا').includes(val));
searchResults.innerHTML='';
filtered.forEach(p=>{
const div=document.createElement('div');
div.className='search-item';
const highlighted=p.name.replace(regex, `<span class="highlight">$1</span>`);
div.innerHTML=`<span>${highlighted} - ${p.price.toLocaleString()} تومان</span><button>+</button>`;
div.querySelector('button').addEventListener('click',()=>{
addToCart(p);
searchBar.value='';searchResults.style.display='none';
});
searchResults.appendChild(div);
});
searchResults.style.display=filtered.length>0?'block':'none';
});

// ======= چاپ فاکتور =======
printBtn.addEventListener('click',()=>{
const invBody=document.getElementById('invBody');
const invTotal=document.getElementById('invTotal');
const invDate=document.getElementById('invDate');
invBody.innerHTML='';
let total=0;
cart.forEach(it=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td style="text-align:right">${it.name}</td><td>${it.qty}</td><td>${it.price.toLocaleString()}</td><td>${(it.price*it.qty).toLocaleString()}</td>`;
invBody.appendChild(tr);
total+=it.price*it.qty;
});
invTotal.textContent=total.toLocaleString();
invDate.textContent=new Date().toLocaleString();
const printContent=document.getElementById('invoicePrint').innerHTML;
const newWin=window.open('','_blank','width=400,height=600');
newWin.document.write('<html><head><title>رسید</title></head><body style="background:white;color:black;">'+printContent+'</body></html>');
newWin.document.close();newWin.focus();newWin.print();newWin.close();
});

// ======= خالی کردن سبد =======
emptyCartBtn.addEventListener('click', () => {
cart = [];
updateCart();
});
</script>
</body>
</html>
